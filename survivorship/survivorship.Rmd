---
title: "survivorship"
author: "allyson_demerlis"
date: "2023-04-17"
output: html_document
---

```{r}
library(tidyverse)
library(survival)
library(ggpubr)
library(survminer)
survivorship <- read.csv("survivorship_data_07112023.csv")
```


```{r}
survivorship %>% 
  pivot_longer(T0_mortality:T3_mortality, names_to = "TimePoint", values_to = "Binary_deadoralive") %>% 
  mutate(Binary_deadoralive = as.factor(Binary_deadoralive)) %>% #change time point to days
  mutate(time = case_when(TimePoint == "T0_mortality" ~ 0,
                         TimePoint == "T1_mortality" ~ 51,
                         TimePoint == "T2_mortality" ~ 119,
                         TimePoint == "T3_mortality" ~ 217)) -> df 

# create survival object using the Kaplan-Meier method
surv <- Surv(time = df$time, event = df$Binary_deadoralive)
surv

# run survival model for each species
fit_reef <- survfit(surv ~ Transplant, data = df)
summary(fit_reef)

# Kaplan-Meier plots for each transplant
fill.color<-c("#43a2ca", "#a97c50","#addd8e", "#006837")

survival_species<-ggsurvplot(df, data = fit_reef, pval = TRUE, xlab="Days", ylab="Survival Probability",
                                    conf.int = T, risk.table=T,palette=fill.color,
                                    break.time.by=31, xlim=c(0,372), risk.table.y.text = FALSE) + ggtitle("Transplant") 
```

```{r}
survivorship %>% 
  pivot_longer(T0_mortality:T3_mortality, names_to = "TimePoint", values_to = "Binary_deadoralive") %>% 
  mutate(Binary_deadoralive = as.factor(Binary_deadoralive)) %>% #change time point to days
  mutate(time = case_when(TimePoint == "T0_mortality" ~ 0,
                         TimePoint == "T1_mortality" ~ 51,
                         TimePoint == "T2_mortality" ~ 119,
                         TimePoint == "T3_mortality" ~ 217)) %>% 
  group_by(Genet, Transplant, time, Binary_deadoralive) %>% 
  summarise(count = n()) %>% 
  ggplot(., aes(x=time, y=count, fill=Binary_deadoralive)) + geom_col() + facet_wrap(~Transplant) +
  theme_classic() +
  scale_fill_manual(values = c("#1c1b1b", "#628573")) +
  labs(fill = "Mortality status", x = "Number of days", y = "Number of outplants")
```

